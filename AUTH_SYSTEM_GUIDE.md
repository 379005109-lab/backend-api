# è®¤è¯ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## âœ… é—®é¢˜å·²è§£å†³

### é—®é¢˜1: æ³¨å†Œæ—¶è·å–éªŒè¯ç ï¼Œå®é™…ä¸Šæ²¡æœ‰æ”¶åˆ°
**åŸå› **: ç³»ç»Ÿä¹‹å‰æ²¡æœ‰å®ç°éªŒè¯ç åŠŸèƒ½ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
- å·²å®ç°å®Œæ•´çš„éªŒè¯ç å‘é€æ¥å£
- å¼€å‘ç¯å¢ƒä¸‹ï¼ŒéªŒè¯ç ä¼šåœ¨åç«¯æ—¥å¿—ä¸­æ˜¾ç¤º
- å‰ç«¯é¡µé¢ä¼šè‡ªåŠ¨æ˜¾ç¤ºéªŒè¯ç ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
- ç”Ÿäº§ç¯å¢ƒéœ€è¦æ¥å…¥çŸ­ä¿¡æœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰

### é—®é¢˜2: è¶…çº§ç®¡ç†å‘˜æ— æ³•ç™»å½•
**åŸå› **: ç³»ç»Ÿä¹‹å‰æ²¡æœ‰è®¤è¯ç³»ç»Ÿï¼ŒUseræ¨¡å‹ä¸åŒ…å«ç™»å½•å­—æ®µã€‚

**è§£å†³æ–¹æ¡ˆ**:
- å·²åˆ›å»ºå®Œæ•´çš„è®¤è¯ç³»ç»Ÿ
- è¶…çº§ç®¡ç†å‘˜è´¦å·å·²åˆ›å»ºå¹¶å¯ä»¥ç™»å½•
- ç”¨æˆ·å: `zcd`
- å¯†ç : `asd123..`
- è§’è‰²: `super_admin`

---

## ğŸ¯ æ–°åŠŸèƒ½è¯´æ˜

### 1. è®¤è¯ç³»ç»Ÿæ¶æ„

#### åç«¯ç»„ä»¶
- **AuthUser æ¨¡å‹** (`/models/AuthUser.js`)
  - ç”¨æˆ·åã€å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
  - æ‰‹æœºå·ã€è§’è‰²ï¼ˆuser/admin/super_adminï¼‰
  - éªŒè¯ç åŠŸèƒ½
  - å¯†ç æ¯”å¯¹æ–¹æ³•

- **è®¤è¯æ§åˆ¶å™¨** (`/controllers/authController.js`)
  - ç”¨æˆ·æ³¨å†Œ
  - ç”¨æˆ·ç™»å½•
  - å‘é€éªŒè¯ç 
  - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

- **è®¤è¯è·¯ç”±** (`/routes/authRoutes.js`)
  - `POST /api/auth/register` - æ³¨å†Œ
  - `POST /api/auth/login` - ç™»å½•
  - `POST /api/auth/send-code` - å‘é€éªŒè¯ç 
  - `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·
  - `GET /api/auth/users` - è·å–æ‰€æœ‰ç”¨æˆ·

#### å‰ç«¯é¡µé¢
- **ç™»å½•é¡µé¢** (`http://localhost:5000/login.html`)
  - å¯†ç ç™»å½•
  - éªŒè¯ç ç™»å½•/æ³¨å†Œ
  - å“åº”å¼è®¾è®¡
  - ç¾è§‚çš„UIç•Œé¢

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è®¿é—®ç™»å½•é¡µé¢

**æ–¹å¼1: æœ¬åœ°è®¿é—®**
```
http://localhost:5000/login.html
```

**æ–¹å¼2: å…¬ç½‘è®¿é—®**
```
https://your-domain.sealoshzh.site/login.html
```

### è¶…çº§ç®¡ç†å‘˜ç™»å½•

1. æ‰“å¼€ç™»å½•é¡µé¢
2. é€‰æ‹©"å¯†ç ç™»å½•"æ ‡ç­¾
3. è¾“å…¥ï¼š
   - ç”¨æˆ·å: `zcd`
   - å¯†ç : `asd123..`
4. ç‚¹å‡»"ç™»å½•"

### æ–°ç”¨æˆ·æ³¨å†Œ

1. æ‰“å¼€ç™»å½•é¡µé¢
2. é€‰æ‹©"éªŒè¯ç ç™»å½•"æ ‡ç­¾
3. å¡«å†™ä¿¡æ¯ï¼š
   - ç”¨æˆ·å: è‡ªå®šä¹‰ï¼ˆè‡³å°‘3ä¸ªå­—ç¬¦ï¼‰
   - æ‰‹æœºå·: 11ä½æ‰‹æœºå·
   - éªŒè¯ç : ç‚¹å‡»"è·å–éªŒè¯ç "
   - å¯†ç : è‡ªå®šä¹‰ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰
4. ç‚¹å‡»"ç™»å½•/æ³¨å†Œ"

### æŸ¥çœ‹éªŒè¯ç ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

**æ–¹æ³•1: å‰ç«¯é¡µé¢æ˜¾ç¤º**
- å‘é€éªŒè¯ç åï¼ŒæˆåŠŸæ¶ˆæ¯ä¼šæ˜¾ç¤ºéªŒè¯ç 
- ä¾‹å¦‚: "éªŒè¯ç å·²å‘é€ï¼å¼€å‘ç¯å¢ƒéªŒè¯ç : 123456"

**æ–¹æ³•2: æŸ¥çœ‹åç«¯æ—¥å¿—**
```bash
pm2 logs backend-api
```

æ—¥å¿—ä¼šæ˜¾ç¤º:
```
=== æ¨¡æ‹Ÿå‘é€éªŒè¯ç  ===
æ‰‹æœºå·: 13800138000
éªŒè¯ç : 123456
æœ‰æ•ˆæœŸ: 10åˆ†é’Ÿ
===================
```

---

## ğŸ” API æ¥å£è¯´æ˜

### 1. ç”¨æˆ·ç™»å½•
```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "zcd",
  "password": "asd123.."
}
```

**æˆåŠŸå“åº”:**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "69121bed69a432291501932b",
      "username": "zcd",
      "role": "super_admin",
      "lastLoginAt": "2025-11-10T17:09:11.000Z"
    }
  },
  "message": "ç™»å½•æˆåŠŸ"
}
```

### 2. å‘é€éªŒè¯ç 
```bash
POST /api/auth/send-code
Content-Type: application/json

{
  "phone": "13800138000"
}
```

**æˆåŠŸå“åº”:**
```json
{
  "success": true,
  "message": "éªŒè¯ç å·²å‘é€",
  "code": "123456"  // ä»…å¼€å‘ç¯å¢ƒè¿”å›
}
```

### 3. ç”¨æˆ·æ³¨å†Œ
```bash
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456",
  "phone": "13800138000",
  "verificationCode": "123456"
}
```

**æˆåŠŸå“åº”:**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "69121bed69a432291501932c",
      "username": "testuser",
      "role": "user",
      "phone": "13800138000"
    }
  },
  "message": "æ³¨å†ŒæˆåŠŸ"
}
```

### 4. è·å–å½“å‰ç”¨æˆ·
```bash
GET /api/auth/me
Authorization: Bearer <token>
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### å¯†ç åŠ å¯†
- ä½¿ç”¨ `bcryptjs` è¿›è¡Œå¯†ç åŠ å¯†
- åŠ å¯†è½®æ•°: 10
- å¯†ç ä¸ä¼šä»¥æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­

### JWT Token
- ä½¿ç”¨ `jsonwebtoken` ç”Ÿæˆtoken
- æœ‰æ•ˆæœŸ: 7å¤©
- TokenåŒ…å«: ç”¨æˆ·IDã€ç”¨æˆ·åã€è§’è‰²

### éªŒè¯ç 
- 6ä½éšæœºæ•°å­—
- æœ‰æ•ˆæœŸ: 10åˆ†é’Ÿ
- å¼€å‘ç¯å¢ƒ: æ§åˆ¶å°è¾“å‡º
- ç”Ÿäº§ç¯å¢ƒ: éœ€æ¥å…¥çŸ­ä¿¡æœåŠ¡

---

## ğŸ“‹ ç®¡ç†è„šæœ¬

### åˆ›å»º/é‡ç½®è¶…çº§ç®¡ç†å‘˜
```bash
cd /home/devbox/project
node create-super-admin.js
```

### æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
```bash
# ä½¿ç”¨ MongoDB æŸ¥è¯¢
node query-db.js

# æˆ–ä½¿ç”¨ API
curl http://localhost:5000/api/auth/users
```

---

## ğŸ”„ æœåŠ¡ç®¡ç†

### é‡å¯åç«¯æœåŠ¡
```bash
pm2 restart backend-api
```

### æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs backend-api
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
pm2 list
```

---

## ğŸ“ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

### 1. ç¯å¢ƒå˜é‡é…ç½®
åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ :
```env
JWT_SECRET=your-super-secret-jwt-key-change-this
NODE_ENV=production
```

### 2. æ¥å…¥çŸ­ä¿¡æœåŠ¡
ä¿®æ”¹ `/controllers/authController.js` ä¸­çš„ `sendVerificationCode` å‡½æ•°ï¼š
- é›†æˆé˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡
- æˆ–é›†æˆè…¾è®¯äº‘çŸ­ä¿¡æœåŠ¡
- æ·»åŠ éªŒè¯ç ç¼“å­˜ï¼ˆRedisï¼‰
- å®ç°é¢‘ç‡é™åˆ¶

### 3. å®‰å…¨å¢å¼º
- HTTPS éƒ¨ç½²
- CORS é…ç½®ä¼˜åŒ–
- æ·»åŠ  rate limiting
- å®ç° token åˆ·æ–°æœºåˆ¶
- æ·»åŠ ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•1: è¶…çº§ç®¡ç†å‘˜ç™»å½•
```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"zcd","password":"asd123.."}'
```

### æµ‹è¯•2: å‘é€éªŒè¯ç 
```bash
curl -X POST http://localhost:5000/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000"}'
```

### æµ‹è¯•3: ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username":"testuser",
    "password":"123456",
    "phone":"13800138000",
    "verificationCode":"123456"
  }'
```

---

## ğŸ‰ ç³»ç»Ÿå·²å°±ç»ªï¼

- âœ… è¶…çº§ç®¡ç†å‘˜å¯ä»¥ç™»å½•
- âœ… éªŒè¯ç åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- âœ… ç™»å½•é¡µé¢ç¾è§‚æ˜“ç”¨

**ç«‹å³è®¿é—®**: http://localhost:5000/login.html
