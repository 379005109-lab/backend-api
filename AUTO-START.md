# è‡ªåŠ¨å¯åŠ¨é…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿå·²é…ç½®ä¸º**å®Œå…¨è‡ªåŠ¨å¯åŠ¨**ï¼Œå³ä½¿å…³é—­Windsurfï¼Œæ‰€æœ‰æœåŠ¡ä¹Ÿä¼šæŒç»­è¿è¡Œã€‚

---

## ğŸ”§ å·²é…ç½®çš„è‡ªåŠ¨å¯åŠ¨æœåŠ¡

### 1. MongoDBæ•°æ®åº“ âœ…

**çŠ¶æ€**: å·²è‡ªåŠ¨è¿è¡Œï¼ˆæ— éœ€æ‰‹åŠ¨é…ç½®ï¼‰

**éƒ¨ç½²æ–¹å¼**: Sealos Kubernetesæ‰˜ç®¡æœåŠ¡
- **æœåŠ¡åœ°å€**: `test-db-mongodb.ns-cxxiwxce.svc`
- **æ•°æ®åº“å**: `backend_db`
- **ç®¡ç†å¹³å°**: Sealosäº‘å¹³å°

**ç‰¹ç‚¹**:
- âœ… äº‘ç«¯æ‰˜ç®¡ï¼Œ24/7è¿è¡Œ
- âœ… è‡ªåŠ¨æ•…éšœæ¢å¤
- âœ… æ— éœ€æ‰‹åŠ¨å¯åŠ¨/åœæ­¢
- âœ… å…³é—­Windsurfä¸å½±å“è¿è¡Œ
- âœ… æ•°æ®æŒä¹…åŒ–å­˜å‚¨

**éªŒè¯æ–¹æ³•**:
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯è¿æ¥
node query-db.js

# æˆ–é€šè¿‡APIæµ‹è¯•
curl http://localhost:5000/health
```

---

### 2. åç«¯APIæœåŠ¡ âœ…

**çŠ¶æ€**: å·²é…ç½®PM2è‡ªåŠ¨å¯åŠ¨

**æœåŠ¡ä¿¡æ¯**:
- **åç§°**: `backend-api`
- **ç«¯å£**: 5000
- **ä½ç½®**: `/home/devbox/project`
- **è¿›ç¨‹ç®¡ç†**: PM2

**PM2é…ç½®**:
```javascript
{
  name: 'backend-api',
  script: './server.js',
  instances: 1,
  autorestart: true,      // å´©æºƒè‡ªåŠ¨é‡å¯
  autostart: true,        // ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
  watch: false,
  max_memory_restart: '1G',
  env: {
    NODE_ENV: 'development',
    PORT: 5000
  }
}
```

**PM2å®ˆæŠ¤è¿›ç¨‹**:
- âœ… PM2å·²ä¿å­˜è¿›ç¨‹åˆ—è¡¨åˆ° `~/.pm2/dump.pm2`
- âœ… è¿›ç¨‹é…ç½®å·²æŒä¹…åŒ–
- âœ… è‡ªåŠ¨é‡å¯æœºåˆ¶å·²å¯ç”¨

**å¸¸ç”¨å‘½ä»¤**:
```bash
pm2 list              # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 logs backend-api  # æŸ¥çœ‹æ—¥å¿—
pm2 restart backend-api  # é‡å¯æœåŠ¡
pm2 save              # ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
```

---

### 3. å‰ç«¯åº”ç”¨æœåŠ¡ âœ…

**çŠ¶æ€**: å·²é…ç½®PM2è‡ªåŠ¨å¯åŠ¨

**æœåŠ¡ä¿¡æ¯**:
- **åç§°**: `frontend-app`
- **ç«¯å£**: 3000
- **ä½ç½®**: `/home/devbox/frontend`
- **è¿›ç¨‹ç®¡ç†**: PM2

**PM2é…ç½®**:
```javascript
{
  name: 'frontend-app',
  cwd: '/home/devbox/frontend',
  script: './serve-frontend.js',
  instances: 1,
  autorestart: true,
  autostart: true,
  env: {
    NODE_ENV: 'production',
    PORT: 3000
  }
}
```

**å‰ç«¯ä»£ç†é…ç½®**:
- APIä»£ç†: `/api/*` â†’ `http://localhost:5000/api/*`
- é™æ€æ–‡ä»¶: `/home/devbox/frontend/dist`

---

## ğŸš€ è‡ªåŠ¨å¯åŠ¨æœºåˆ¶

### å·¥ä½œåŸç†

```
å®¹å™¨å¯åŠ¨
    â†“
PM2å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨
    â†“
è¯»å– ~/.pm2/dump.pm2
    â†“
è‡ªåŠ¨å¯åŠ¨ backend-api (ç«¯å£5000)
    â†“
è‡ªåŠ¨å¯åŠ¨ frontend-app (ç«¯å£3000)
    â†“
è‡ªåŠ¨è¿æ¥ MongoDB (äº‘ç«¯æœåŠ¡)
    â†“
âœ… æ‰€æœ‰æœåŠ¡è¿è¡Œä¸­
```

### æŒä¹…åŒ–ä¿è¯

1. **MongoDB**: 
   - è¿è¡Œåœ¨Sealos Kubernetesé›†ç¾¤
   - ç‹¬ç«‹äºæœ¬åœ°ç¯å¢ƒ
   - æ°¸ä¹…åœ¨çº¿

2. **å‰åç«¯åº”ç”¨**:
   - PM2è¿›ç¨‹åˆ—è¡¨å·²ä¿å­˜
   - autostartå·²å¯ç”¨
   - å®¹å™¨é‡å¯æ—¶è‡ªåŠ¨æ¢å¤

---

## âš™ï¸ é…ç½®æ–‡ä»¶ä½ç½®

| ç»„ä»¶ | é…ç½®æ–‡ä»¶ | è¯´æ˜ |
|------|---------|------|
| PM2é…ç½® | `/home/devbox/project/ecosystem.config.js` | åŒæœåŠ¡é…ç½® |
| PM2è¿›ç¨‹åˆ—è¡¨ | `~/.pm2/dump.pm2` | æŒä¹…åŒ–è¿›ç¨‹çŠ¶æ€ |
| å‰ç«¯æœåŠ¡ | `/home/devbox/frontend/serve-frontend.js` | Expressé™æ€æœåŠ¡å™¨ |
| åç«¯æœåŠ¡ | `/home/devbox/project/server.js` | Express APIæœåŠ¡å™¨ |
| æ•°æ®åº“é…ç½® | `/home/devbox/project/config/database.js` | Mongooseè¿æ¥ |

---

## ğŸ” éªŒè¯è‡ªåŠ¨å¯åŠ¨

### æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€

```bash
# 1. æ£€æŸ¥PM2æœåŠ¡
pm2 list

# æœŸæœ›è¾“å‡º:
# â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚
# â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ 0  â”‚ backend-api        â”‚ cluster  â”‚ 12   â”‚ online    â”‚
# â”‚ 1  â”‚ frontend-app       â”‚ cluster  â”‚ 14   â”‚ online    â”‚
# â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```bash
# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tuln | grep -E ':(3000|5000)'

# æœŸæœ›è¾“å‡º:
# tcp    0    0 0.0.0.0:5000    0.0.0.0:*    LISTEN
# tcp    0    0 0.0.0.0:3000    0.0.0.0:*    LISTEN
```

```bash
# 3. æµ‹è¯•APIè¿æ¥
curl http://localhost:5000/health

# æœŸæœ›è¾“å‡º:
# {"status":"OK","timestamp":"...","environment":"development"}
```

```bash
# 4. æµ‹è¯•æ•°æ®åº“è¿æ¥
node /home/devbox/project/query-db.js

# æœŸæœ›è¾“å‡º:
# âœ… æˆåŠŸè¿æ¥åˆ°MongoDB
# ğŸ“Š æ•°æ®åº“: backend_db
# ğŸ”— ä¸»æœº: test-db-mongodb.ns-cxxiwxce.svc
```

---

## ğŸ› ï¸ ç»´æŠ¤å‘½ä»¤

### PM2å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 list
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs                    # æ‰€æœ‰æœåŠ¡æ—¥å¿—
pm2 logs backend-api        # åç«¯æ—¥å¿—
pm2 logs frontend-app       # å‰ç«¯æ—¥å¿—
pm2 logs --lines 100        # æŸ¥çœ‹æœ€è¿‘100è¡Œ

# é‡å¯æœåŠ¡
pm2 restart all             # é‡å¯æ‰€æœ‰
pm2 restart backend-api     # é‡å¯åç«¯
pm2 restart frontend-app    # é‡å¯å‰ç«¯

# åœæ­¢æœåŠ¡ï¼ˆä¸æ¨èï¼Œä¼šåœ¨é‡å¯åè‡ªåŠ¨æ¢å¤ï¼‰
pm2 stop all

# ä¿å­˜å½“å‰çŠ¶æ€
pm2 save

# ç›‘æ§
pm2 monit
```

### æ•°æ®åº“æŸ¥è¯¢

```bash
# æŸ¥è¯¢æ‰€æœ‰å•†å“
node query-db.js

# é€šè¿‡APIæŸ¥è¯¢
curl http://localhost:5000/api/products

# åˆ›å»ºæ–°å•†å“
curl -X POST http://localhost:5000/api/products \
  -H "Content-Type: application/json" \
  -d '{"productName":"æµ‹è¯•","model":"TEST001","category":"æ²™å‘","listPrice":1000,"stock":10}'
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å…³é—­WindsurfåæœåŠ¡ä¼šåœæ­¢å—ï¼Ÿ
**A**: ä¸ä¼šï¼æ‰€æœ‰æœåŠ¡éƒ½ä¼šç»§ç»­è¿è¡Œï¼š
- MongoDBåœ¨äº‘ç«¯ç‹¬ç«‹è¿è¡Œ
- PM2å®ˆæŠ¤è¿›ç¨‹æŒç»­ç®¡ç†å‰åç«¯åº”ç”¨
- å®¹å™¨ç¯å¢ƒæŒç»­å­˜åœ¨

### Q2: å¦‚ä½•ç¡®è®¤æœåŠ¡æ­£åœ¨è¿è¡Œï¼Ÿ
**A**: è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
pm2 list
curl http://localhost:5000/health
```

### Q3: æœåŠ¡æ„å¤–åœæ­¢æ€ä¹ˆåŠï¼Ÿ
**A**: PM2ä¼šè‡ªåŠ¨é‡å¯ã€‚å¦‚æœéœ€è¦æ‰‹åŠ¨å¯åŠ¨ï¼š
```bash
pm2 resurrect  # æ¢å¤ä¹‹å‰ä¿å­˜çš„è¿›ç¨‹
# æˆ–
pm2 restart all
```

### Q4: å¦‚ä½•æ›´æ–°ä»£ç åé‡å¯æœåŠ¡ï¼Ÿ
**A**: 
```bash
# æ›´æ–°åç«¯ä»£ç 
cd /home/devbox/project
pm2 restart backend-api

# æ›´æ–°å‰ç«¯ä»£ç 
cd /home/devbox/frontend
npm run build
pm2 restart frontend-app
```

### Q5: æ•°æ®åº“è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. æ£€æŸ¥ç¯å¢ƒå˜é‡ `MONGODB_URI`
2. éªŒè¯MongoDBæœåŠ¡çŠ¶æ€ï¼ˆSealoså¹³å°ï¼‰
3. è¿è¡Œæµ‹è¯•è„šæœ¬: `node query-db.js`

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Sealos Kubernetes å¹³å°                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MongoDB æœåŠ¡ (æ‰˜ç®¡)                     â”‚  â”‚
â”‚  â”‚  - 24/7è¿è¡Œ                              â”‚  â”‚
â”‚  â”‚  - è‡ªåŠ¨æ•…éšœæ¢å¤                          â”‚  â”‚
â”‚  â”‚  - æ•°æ®æŒä¹…åŒ–                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ MongoDBè¿æ¥
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Devbox å®¹å™¨ç¯å¢ƒ                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PM2 è¿›ç¨‹ç®¡ç†å™¨ (å®ˆæŠ¤è¿›ç¨‹)           â”‚    â”‚
â”‚  â”‚                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ backend-api (ç«¯å£5000)          â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - Express APIæœåŠ¡å™¨             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - autorestart: true             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - autostart: true               â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ frontend-app (ç«¯å£3000)         â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - Expressé™æ€æœåŠ¡å™¨             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - APIä»£ç† â†’ 5000                â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - autorestart: true             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ - autostart: true               â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTPS
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å…¬ç½‘è®¿é—®                               â”‚
â”‚  https://dlzrpxrppejh.sealoshzh.site         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æ€»ç»“

æ‚¨çš„ç³»ç»Ÿå·²ç»**å®Œå…¨é…ç½®å¥½è‡ªåŠ¨å¯åŠ¨**ï¼š

1. âœ… **MongoDBæ•°æ®åº“**: äº‘ç«¯æ‰˜ç®¡ï¼Œæ°¸ä¹…åœ¨çº¿
2. âœ… **åç«¯API**: PM2ç®¡ç†ï¼Œè‡ªåŠ¨å¯åŠ¨å’Œé‡å¯
3. âœ… **å‰ç«¯åº”ç”¨**: PM2ç®¡ç†ï¼Œè‡ªåŠ¨å¯åŠ¨å’Œé‡å¯
4. âœ… **è¿›ç¨‹æŒä¹…åŒ–**: PM2å·²ä¿å­˜é…ç½®
5. âœ… **æ•…éšœæ¢å¤**: è‡ªåŠ¨é‡å¯æœºåˆ¶å·²å¯ç”¨

**å…³é—­Windsurfä¸ä¼šå½±å“ä»»ä½•æœåŠ¡çš„è¿è¡Œï¼**

---

ç”Ÿæˆæ—¶é—´: 2025-11-10
ç»´æŠ¤è€…: DevBox Team
